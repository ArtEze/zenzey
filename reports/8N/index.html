<!doctype html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Insights graph demo</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-responsive.css" />
    <link rel="stylesheet" href="assets/insights/insights-default.css" />
    <link rel="stylesheet" href="assets/jQRangeSlider/css/iThing.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="span12">
          <h1>An&aacute;lisis del #8N</h1>
          <form class="form-search">
            <input id="name-search" type="text" class="input-medium search-query" placeholder="buscar" />
          </form> 
          <div id="parent" style="position:relative">
            <div class="btn-group btn-group-vertical" style="position:absolute;top:10px;right:10px;">
              <button id="zoom-in" type="button" class="btn"><i class="icon-zoom-in"></i></button>
              <button id="zoom-out" type="button" class="btn"><i class="icon-zoom-out"></i></button>
            </div>
            <div id="loading">Cargando...</div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="span12">
         <div id="count-slider"></div>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="assets/insights/insights.packaged.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="assets/jQRangeSlider/jQRangeSlider-min.js"></script>

    <script>
      !function() {
        d3.json("8N.json", function(data) {
          var nodes = data[0],
              links = data[1],
              $el = $("#parent"),
              $slider = $("#count-slider"),
              $search = $("#name-search");
          var min, max;

          //var nodes = data[0].slice(0, 100),
          //    links = data[1].slice(0, 200),
          graph = new InsightsGraph($el.get(0), nodes, links, {
            width: $el.width(),
            height: $el.height(),
            collisionAlpha: 15,
            tooltipTemplate: "<div>usuario: {{ text }}</div><div>interacciones: {{ count }}</div>",
            onReset: function() {
              $slider.rangeSlider("values", min, max);
              $search.val("");
            },
            onRendered: function() {
              $("#loading").hide();
            }
          });

          min = 0; max = graph.max.count + 10;

          var sliderValues = {};
          $slider.rangeSlider({ 
                arrows: false,
                step: 10, 
                formatter: function(val) {
                  return val + " interacciones";
                },
                bounds: { 
                    min: min,
                    max: max,
                }, 
                defaultValues: { 
                    min: min,
                    max: max
                } 
            }).on("valuesChanged", function(e, data) {                                 
                var vals = sliderValues;                                         

                if (vals.max !== data.values.max || vals.min !== data.values.min) { 
                    graph.selectBy(function(d) {
                      return d.count > data.values.min && d.count < data.values.max;
                    });
                }                                                                      
        
                sliderValues = data.values;                                      
            });
        });

        $("#name-search").keyup(function(ev) {
           var val, ch,
               $el = $(this);

            if (ev.keyCode == 27) { // key: esc
                graph.reset();
                $el.val("");
                return;
            }

            val = $el.val();
            ch = String.fromCharCode(ev.keyCode || ev.charCode);

            ch && graph.selectByText(val);
        });

        $("#zoom-in").click(function(ev) {
          ev.preventDefault();ev.stopPropagation();
          graph.zoomIn();
        });

        $("#zoom-out").click(function(ev) {
          ev.preventDefault();ev.stopPropagation();
          graph.zoomOut();
        });
      }();
    </script>
  </body>
</html>
